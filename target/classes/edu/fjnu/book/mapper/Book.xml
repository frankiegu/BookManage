<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.fjnu.book.mapper.BookMapper">
	<!-- 数据库表映射 -->
	<resultMap id="bookRM" type="edu.fjnu.book.domain.Book">
		<id property="bookid" column="bookid"/>
		<result property="bookname" column="bookname"/>
		<result property="author" column="author"/>
		<!-- <result property="press" column="press"/> -->
		<!-- <result property="typeid" column="typeid"/> -->
		<result property="price" column="price"/>
		<result property="content" column="content"/>
		<result property="keyword" column="keyword"/>
		<result property="evaluateid" column="evaluateid"/>
		<result property="imageUrl" column="imageUrl"/>
		<result property="score" column="score"/>
		<association property="publisher" javaType="edu.fjnu.book.domain.Publisher">
			<id property="id" column="id"/>
			<result property="name" column="name"/>
			<result property="status" column="status"/>
			<result property="remark" column="remark"/>
		</association>
		<association property="bookType" javaType="edu.fjnu.book.domain.BookType">
			<id property="typeId" column="typeid"/>
			<result property="typeName" column="typename"/>
			<result property="status" column="status"/>
			<result property="remark" column="remark"/>
		</association>
	</resultMap>
	
	<!-- 新增 -->
	<insert id="insert" parameterType="edu.fjnu.book.domain.Book">
		insert into t_book
		(bookname,author,press,typeid,price,content,keyword,evaluateid,imageUrl,score)
		values
		(#{bookname},#{author},#{publisher.id},#{bookType.typeId},#{price},#{content},#{keyword},#{evaluateid},#{imageUrl},#{score})
	</insert>
	
	<!-- 修改 -->
	<update id="update" parameterType="edu.fjnu.book.domain.Book">
		update t_book
		<set>
			<if test="bookname!=null">
				bookname=#{bookname},
			</if>
			<if test="author!=null">
				author=#{author},
			</if>
			<if test="publisher.id !=null">
				press=#{publisher.id},
			</if>
			<if test="bookType.typeId !=null">
				typeid=#{bookType.typeId},
			</if>
			<if test="price!=null">
				price=#{price},
			</if>
			<if test="content!=null">
				content=#{content},
			</if>
			<if test="keyword!=null">
				keyword=#{keyword},
			</if>
			<if test="evaluateid!=null">
				evaluateid=#{evaluateid},
			</if>
			<if test="imageUrl!=null">
				imageUrl=#{imageUrl},
			</if>
			<if test="score != null">
				score = #{score}
			</if>
		</set>
			where bookid=#{bookid}
	</update>
	
	<!-- 查询所有记录 -->
	<select id="find" parameterType="string" resultMap="bookRM">
		select * from t_book b ,t_publisher p ,t_type t
			where b.press = p.id
			and b.typeid = t.typeid
			order by b.score desc,b.bookid 
	</select>
	
	<!-- 查询所有待审核记录 -->
	<select id="findPending" parameterType="string" resultMap="bookRM">
		select * from t_book b ,t_publisher p ,t_type t
			where b.press = p.id
			and b.typeid = t.typeid
			order by b.score desc,b.bookid 
	</select>
	
	<!-- 查询一个录 -->
	<select id="get" parameterType="edu.fjnu.book.domain.Book" resultMap="bookRM">
		select * from t_book b ,t_publisher p ,t_type t
			where b.press = p.id
			and b.typeid = t.typeid
			and b.bookid=#{bookid} 
	</select>
	
	<!-- 删除一条记录 -->
	<delete id="delete" parameterType="string">
		delete from t_book
		where bookid=#{bookid}
	</delete>
	
	<!-- 查询一个录 -->
	<select id="getStu" parameterType="edu.fjnu.book.domain.Book" resultMap="bookRM">
		select * from t_book b ,t_publisher p ,t_type t
			where b.press = p.id
			and b.typeid = t.typeid
			and b.bookid=#{bookid} 
	</select>
</mapper>